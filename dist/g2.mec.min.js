/**
 * g2 (c) 2013-16 Stefan Goessner
 * @file mechanical extensions to `g2`.
 * @author Stefan Goessner
 * @license MIT License
 */
var g2=g2||{prototype:{}};g2.prototype.mark=function t(o,n,r){var i=this.findCmdIdx(function(t){return"len"in t&&"p"in t});if(o&&i!==false){var e=this.cmds[i],s={},l,c=e.loc?e.loc([].concat(n)):[].concat(n);for(var a=0;a<c.length&&!s.done;a++){s=e.p(c[a]);l=r<0?Math.atan2(-s.dy,-s.dx):r>0?Math.atan2(s.dy,s.dx):0;this.use(o,{x:s.x,y:s.y,w:l,scl:1,ls:e.style&&e.style.ls||"@ls",fs:"@ls"})}}return this};g2.prototype.label=function o(t,n,r){var i=this.findCmdIdx(function(t){return"p"in t});if(i!==false){n=n==="mid"?.5:n;var e=this.cmds[i],l=e.p(e.loc?e.loc(n):n),c=r+0===r?r||1:n==="c"?0:(r==="left"?-1:1)*this.state.get("labelOffset"),a=l.dy*c,y=-l.dx*c;l.x+=a;l.y+=y;if(t[0]==="@"&&(s=e[t.substr(1)]))t=""+Number(s).toFixed(Math.max(g2.State.labelSignificantDigits-Math.log10(s),0))+(t.substr(1)==="angle"?"Â°":"");return this.txt(t,l.x,l.y,0,{thal:a>0?"left":a<0?"right":"center",tval:this.state.cartesian?y>0?"bottom":y<0?"top":"middle":y<0?"bottom":y>0?"top":"middle"})}return this};g2.prototype.vec=function n(t,o,r){var i=t&&t.x||0,e=typeof o==="object"?"x"in o?o.x:"dx"in o?i+o.dx:"r"in o?i+o.r*Math.cos(o.w||0):0:i+10,s=t&&t.y||0,l=typeof o==="object"?"y"in o?o.y:"dy"in o?s+o.dy:"r"in o?s+o.r*Math.sin(o.w||0):0:s,c,a,y=e-i,h=l-s,u=Math.hypot(y,h),d=u>0?y/u:0,p=u>0?h/u:0,f=Object.assign({},r,{fs:"@ls",lc:"round",lj:"round"});if(u>12)this.p().m(i,s).l(c=e,a=l).m(c,a).l(c+=-12*d-2.5*p,a+=-12*p+2.5*d).a(-Math.PI/3,c+5*p,a-5*d).z().drw(f);else this.lin(i,s,e,l,f);return this.proxy(g2.prototype.lin,[i,s,e,l])};g2.prototype.avec=function r(t,o,n,i,e){n=n||0;i=i||Math.PI/2;var s=t.x||0,l=t.y||0,c=i>=0?-12/o:12/o,a=Math.cos(n+i+c),y=Math.sin(n+i+c);return this.beg(Object.assign({ls:"@nodcolor",lw:1},e,{fs:"@ls",lc:"round",lj:"round"})).arc(s,l,o,n,i,{fs:"transparent"}).p().m(s+o*Math.cos(n+i),l+o*Math.sin(n+i)).l(s+(o-2.5)*a,l+(o-2.5)*y).a(Math.PI/3,s+(o+2.5)*a,l+(o+2.5)*y).z().drw().end().proxy(g2.prototype.arc,[s,l,o,n,i])};g2.prototype.dim=function i(t,o,n){var r=t&&t.x||0,i=typeof o==="object"?"x"in o?o.x:"dx"in o?r+o.dx:"r"in o?r+o.r*Math.cos(o.w||0):0:r+10,e=t&&t.y||0,s=typeof o==="object"?"y"in o?o.y:"dy"in o?e+o.dy:"r"in o?e+o.r*Math.sin(o.w||0):0:e,l,c,a=i-r,y=s-e,h=Math.hypot(a,y),u=n&&n.pos==="out"?-1:1,d=u*(h>0?a/h:0),p=u*(h>0?y/h:0);return this.p().m(r,e).l(i,s).m(l=r,c=e).l(l+=12*d-2.5*p,c+=12*p+2.5*d).a(Math.PI/3,l+=5*p,c+=-5*d).z().m(r+3*p,e-3*d).l(r-3*p,e+3*d).z().m(l=i,c=s).l(l+=-12*d-2.5*p,c+=-12*p+2.5*d).a(-Math.PI/3,l+=5*p,c+=-5*d).z().m(i+3*p,s-3*d).l(i-3*p,s+3*d).z().drw(Object.assign({ls:"@dimcolor"},n,{fs:"@ls",lc:"round",lj:"round"})).proxy(g2.prototype.lin,[r,e,i,s])};g2.prototype.adim=function e(t,o,n,r,i){n=n||0;r=r||Math.PI/2;var e=t.x||0,s=t.y||0,l=i&&i.pos==="out"?-1:1,c=l*(r>=0?12/o:-12/o),a=o-2.5,y=o+2.5,h=Math.cos(n),u=Math.sin(n),d=Math.cos(n+r),p=Math.sin(n+r),f=Math.cos(n+c),x=Math.sin(n+c),g=Math.cos(n+r-c),b=Math.sin(n+r-c);return this.beg(Object.assign({},i,{fs:"@ls",lc:"round",lj:"round"})).arc(e,s,o,n,r,{fs:"transparent"}).p().m(e+o*h,s+o*u).l(e+a*f,s+a*x).a(l*Math.PI/3,e+y*f,s+y*x).z().m(e+a*h,s+a*u).l(e+y*h,s+y*u).m(e+o*d,s+o*p).l(e+a*g,s+a*b).a(-l*Math.PI/3,e+y*g,s+y*b).z().m(e+a*d,s+a*p).l(e+y*d,s+y*p).drw().end().proxy(g2.prototype.arc,[e,s,o,n,r])};g2.prototype.slider=function l(t,o,n){var r=t.x||0,i=t.y||0,e=n&&n.b||32,s=n&&n.h||16;return this.beg(Object.assign({x:r,y:i,w:o||0,ls:"@nodcolor",fs:"@linkfill",lw:1},n,{lj:"round"})).rec(-e/2,-s/2,e,s).end().proxy(g2.prototype.rec,[r,i,e,s,n])};g2.prototype.spring=function c(t,o,n){var r=t&&t.x||0,i=typeof o==="object"?"x"in o?o.x:"dx"in o?r+o.dx:"r"in o?r+o.r*Math.cos(o.w||0):0:r+10,e=t&&t.y||0,s=typeof o==="object"?"y"in o?o.y:"dy"in o?e+o.dy:"r"in o?e+o.r*Math.sin(o.w||0):0:e,l=Math.hypot(i-r,s-e),c=n&&n.h||16;if(l<=c)return this.lin(r,e,i,s,{ls:"@nodcolor"},n,{lc:"round",lj:"round"});else{var a={x1:r,y1:e,x2:i,y2:s,ux:(i-r)/l,uy:(s-e)/l},y=(r+i)/2,h=(e+s)/2;return this.p().m(a.x1,a.y1).l(y-a.ux*c/2,h-a.uy*c/2).l(y+(-a.ux/6+a.uy/2)*c,h+(-a.uy/6-a.ux/2)*c).l(y+(a.ux/6-a.uy/2)*c,h+(a.uy/6+a.ux/2)*c).l(y+a.ux*c/2,h+a.uy*c/2).l(a.x2,a.y2).stroke(Object.assign({ls:"@nodcolor"},n,{fs:"transparent",lc:"round",lj:"round"})).proxy(g2.prototype.lin,[r,e,i,s,n])}};g2.prototype.damper=function(t,o,n){var r=t&&t.x||0,i=typeof o==="object"?"x"in o?o.x:"dx"in o?r+o.dx:"r"in o?r+o.r*Math.cos(o.w||0):0:r+10,e=t&&t.y||0,s=typeof o==="object"?"y"in o?o.y:"dy"in o?e+o.dy:"r"in o?e+o.r*Math.sin(o.w||0):0:e,l=Math.hypot(i-r,s-e),c=n&&n.h||16;if(l<=c)return this.lin(r,e,i,s,{ls:"@nodcolor"},n,{lc:"round",lj:"round"});else{var a={x1:r,y1:e,x2:i,y2:s,ux:(i-r)/l,uy:(s-e)/l},y=(r+i)/2,h=(e+s)/2;return this.p().m(a.x1,a.y1).l(y-a.ux*c/2,h-a.uy*c/2).m(y+(a.ux-a.uy)*c/2,h+(a.uy+a.ux)*c/2).l(y+(-a.ux-a.uy)*c/2,h+(-a.uy+a.ux)*c/2).l(y+(-a.ux+a.uy)*c/2,h+(-a.uy-a.ux)*c/2).l(y+(a.ux+a.uy)*c/2,h+(a.uy-a.ux)*c/2).m(y,h).l(a.x2,a.y2).stroke(Object.assign({ls:"@nodcolor"},n,{fs:"transparent",lc:"round",lj:"round"})).proxy(g2.prototype.lin,[r,e,i,s,n])}};g2.prototype.link=function a(t,o){return this.ply(t,o,{fs:o===true?"@linkfill":"transparent",ls:"@linkcolor",lw:5,lc:"round",lj:"round"}).proxy(g2.prototype.ply,[t])};g2.prototype.link2=function y(t,o,n){return this.cpy(o===true?this.ply(t,o,{ls:"transparent",fs:"@linkfill",lw:7,lc:"round",lj:"round"}):this).ply(t,o,{ls:"@nodcolor",lw:7,lc:"round",lj:"round",fs:"transparent"}).ply(t,o,{ls:"@nodfill2",lw:4.5,lc:"round",lj:"round",fs:"transparent"}).ply(t,o,{ls:"@nodfill",lw:2,lc:"round",lj:"round",fs:"transparent"}).proxy(g2.prototype.ply,[t])};g2.prototype.bar=function h(t,o){var n=t&&t.x||0,r=typeof o==="object"?"x"in o?o.x:"dx"in o?n+o.dx:"r"in o?n+o.r*Math.cos(o.w||0):0:n+10,i=t&&t.y||0,e=typeof o==="object"?"y"in o?o.y:"dy"in o?i+o.dy:"r"in o?i+o.r*Math.sin(o.w||0):0:i;return this.lin(n,i,r,e,{ls:"@linkcolor",lw:6,lc:"round"}).proxy(g2.prototype.lin,[n,i,r,e])};g2.prototype.bar2=function u(t,o){var n=t&&t.x||0,r=typeof o==="object"?"x"in o?o.x:"dx"in o?n+o.dx:"r"in o?n+o.r*Math.cos(o.w||0):0:n+10,i=t&&t.y||0,e=typeof o==="object"?"y"in o?o.y:"dy"in o?i+o.dy:"r"in o?i+o.r*Math.sin(o.w||0):0:i;return this.lin(n,i,r,e,{ls:"@nodcolor",lw:7,lc:"round"}).lin(n,i,r,e,{ls:"@nodfill2",lw:4.5,lc:"round"}).lin(n,i,r,e,{ls:"@nodfill",lw:2,lc:"round"}).proxy(g2.prototype.lin,[n,i,r,e])};g2.prototype.ground=function d(t,o,n){var r=0,i,e,s,l,c,a,y,h,u,d,p,f=[],x=n&&n.h||4,g=n&&n.pos==="left"?1:-1,b=g2.prototype.ply.itrOf(t,n);i=e=b(t,r=0);f.push(i);l=b(t,r=1);a=l.x-e.x;y=l.y-e.y;d=Math.hypot(a,y)||1;c=h={x:a/d,y:y/d};for(s=b(t,++r);!s.done;s=b(t,++r)){a=s.x-l.x;y=s.y-l.y;d=Math.hypot(a,y)||1;u={x:a/d,y:y/d};p=(1-u.x*h.x-u.y*h.y)/(h.y*u.x-h.x*u.y);f.push({x:l.x+g*(x+1)*(p*h.x-h.y),y:l.y+g*(x+1)*(p*h.y+h.x)});h=u;e=l;l=s}if(o){a=i.x-l.x;y=i.y-l.y;d=Math.hypot(a,y)||1;u={x:a/d,y:y/d};p=(1-u.x*h.x-u.y*h.y)/(h.y*u.x-h.x*u.y);f.push({x:l.x+g*(x+1)*(p*h.x-h.y),y:l.y+g*(x+1)*(p*h.y+h.x)});p=(1-c.x*u.x-c.y*u.y)/(u.y*c.x-u.x*c.y);f[0]={x:i.x+g*(x+1)*(-p*c.x-c.y),y:i.y+g*(x+1)*(-p*c.y+c.x)}}else{f[0]={x:i.x-g*(x+1)*c.y,y:i.y+g*(x+1)*c.x};f.push({x:l.x-g*(x+1)*h.y,y:l.y+g*(x+1)*h.x})}return this.beg(Object.assign({x:-.5,y:-.5,ls:"@linkcolor",fs:"transparent",lw:2},n,{fs:"transparent",lc:"butt",lj:"miter"})).ply(t,o,n).ply(f,o,{ls:"@nodfill2",lw:2*x}).end()};g2.State=g2.State||{};g2.State.nodcolor="#333";g2.State.nodfill="#dedede";g2.State.nodfill2="#aeaeae";g2.State.linkcolor="#666";g2.State.linkfill="rgba(200,200,200,0.5)";g2.State.dimcolor="darkslategray";g2.State.solid=[];g2.State.dash=[15,10];g2.State.dot=[4,4];g2.State.dashdot=[25,6.5,2,6.5];g2.State.labelOffset=5;g2.State.labelSignificantDigits=3;g2.symbol=g2.symbol||{};g2.symbol.origin=function(){var t=3.5;return g2().beg({lc:"round",lj:"round",lw:1,fs:"@nodfill"}).p().m(6*t,0).l(0,0).l(0,6*t).stroke().p().m(10*t,0).l(6*t,3/4*t).a(-Math.PI/3,6*t,-3/4*t).z().m(0,10*t).l(3/4*t,6*t).a(Math.PI/3,-3/4*t,6*t).z().drw().cir(0,0,t).end()}();g2.symbol.nod=g2().cir(0,0,6,{ls:"@nodcolor",fs:"@nodfill",lwnosc:true});g2.symbol.dblnod=g2().cir(0,0,6,{ls:"@nodcolor",fs:"@nodfill"}).cir(0,0,3,{ls:"@nodcolor",fs:"@nodfill2"});g2.symbol.nodfix=g2().style({ls:"@nodcolor",fs:"@nodfill",lwnosc:true}).p().m(-8,-12).l(0,0).l(8,-12).drw({fs:"@nodfill2"}).cir(0,0,6);g2.symbol.dblnodfix=g2().p().m(-8,-12).l(0,0).l(8,-12).drw({ls:"@nodcolor",fs:"@nodfill2"}).cir(0,0,6,{ls:"@nodcolor",fs:"@nodfill"}).cir(0,0,3,{ls:"@nodcolor",fs:"@nodfill2"});g2.symbol.nodflt=g2().style({ls:"@nodcolor",fs:"@nodfill",lwnosc:true}).p().m(-8,-12).l(0,0).l(8,-12).z().drw({fs:"@nodfill2"}).cir(0,0,6,{fs:"@nodfill"}).lin(-9,-19,9,-19,{ls:"@nodfill2",lw:5,lwnosc:false}).lin(-9,-15.5,9,-15.5,{ls:"@nodcolor",lw:2,lwnosc:false});g2.symbol.dblnodflt=g2().style({ls:"@nodcolor",fs:"@nodfill2",lwnosc:true}).p().m(-8,-12).l(0,0).l(8,-12).z().drw().cir(0,0,6,{fs:"@nodfill"}).cir(0,0,3).lin(-9,-19,9,-19,{ls:"@nodfill2",lw:5,lwnosc:false}).lin(-9,-15.5,9,-15.5,{lw:2,lwnosc:false});g2.symbol.gnd=g2().cir(0,0,6,{ls:"@nodcolor",fs:"@nodfill",lwnosc:true}).p().m(0,6).a(-Math.PI/2,6,0).l(-6,0).a(Math.PI/2,0,-6).z().fill({fs:"@nodcolor"});g2.symbol.pol=g2().cir(0,0,6,{ls:"@nodcolor",fs:"@nodfill",lwnosc:true}).cir(0,0,2.5,{ls:"@nodcolor",fs:"@nodcolor"});g2.symbol.dot=g2().cir(0,0,2,{fs:"@ls"});g2.symbol.sqr=g2().rec(-2,-2,4,4,{fs:"@ls"});g2.symbol.tilde=g2().p().m(0,4).a(Math.PI/2,0,0).a(-Math.PI/2,0,-4).stroke({lc:"round"});g2.symbol.arrow=g2().p().m(0,0).l(-7,-2).a(Math.PI/3,-7,2).z().drw({fs:"@ls",lj:"round"});g2.symbol.tick=g2().p().m(0,-3).l(0,3).stroke({lc:"round"});g2.symbol.arrowtick=g2().p().m(0,-3).l(0,3).m(0,0).l(-7,-2).a(Math.PI/3,-7,2).z().drw({lj:"round",lc:"round"});g2.prototype.lin.proto={get x1(){return this.a[0]},get y1(){return this.a[1]},get dx(){return this.a[2]-this.a[0]},get dy(){return this.a[3]-this.a[1]},get len(){return Math.hypot(this.dx,this.dy)},get style(){return this.a[4]},p:function(t){var o=t==="beg"?0:t==="end"?1:t+0===t?t:.5,n=this.g2.state.cartesian?this.len:-this.len;return{x:this.x1+this.dx*o,y:this.y1+this.dy*o,dx:this.dx/n,dy:this.dy/n}}};g2.prototype.rec.proto={dir:{c:[0,0,1],e:[1,0,1],ne:[1,-1,Math.SQRT2],n:[0,-1,1],nw:[-1,-1,Math.SQRT2],w:[-1,0,1],sw:[-1,1,Math.SQRT2],s:[0,1,1],se:[1,1,Math.SQRT2]},get x(){return this.a[0]},get y(){return this.a[1]},get b(){return this.a[2]},get h(){return this.a[3]},get len(){return 2*(this.b+this.h)},get style(){return this.a[4]},p:function(t){var o=this.dir[t||"c"]||this.dir["c"],n=o[0],r=this.g2.state.cartesian?-o[1]:o[1];return{x:this.x+(1+n)*this.b/2,y:this.y+(1+r)*this.h/2,dx:-r/o[2],dy:n/o[2]}}};g2.prototype.cir.proto={dir:{c:[0,0],e:[1,0],ne:[Math.SQRT2/2,Math.SQRT2/2],n:[0,1],nw:[-Math.SQRT2/2,Math.SQRT2/2],w:[-1,0],sw:[-Math.SQRT2/2,-Math.SQRT2/2],s:[0,-1],se:[Math.SQRT2/2,-Math.SQRT2/2]},get x(){return this.a[0]},get y(){return this.a[1]},get r(){return this.a[2]},get len(){return 2*Math.PI*this.r},get style(){return this.a[3]},p:function(t){var o=t+0===t?[Math.cos(t*2*Math.PI),Math.sin(t*2*Math.PI)]:this.dir[t||"c"],n=o[0],r=this.g2.state.cartesian?o[1]:-o[1];return{x:this.x+n*this.r,y:this.y+r*this.r,dx:-r,dy:n}}};g2.prototype.arc.proto={get x(){return this.a[0]},get y(){return this.a[1]},get r(){return this.a[2]},get w(){return this.a[3]},get dw(){return this.a[4]},get len(){return Math.abs(this.r*this.dw)},get angle(){return this.dw/Math.PI*180},get style(){return this.a[5]},p:function(t){var o=t==="beg"?0:t==="end"?1:t==="mid"?.5:t+0===t?t:.5,n=this.w+o*this.dw,r=Math.cos(n),i=Math.sin(n),e=t==="c"?0:this.r;return{x:this.x+e*r,y:this.y+e*i,dx:-i,dy:r}}};g2.prototype.ply.proto={get pts(){return this.a[0]},get itr(){return g2.prototype.ply.itrOf(this.a[0],this.a[2])},get n(){return this.count||(this.count=this.itr(this.pts).count)},get closed(){return this.a[1]===true},get len(){var t,o,n=this.itr,r=n(this.pts,0),i,e=this.n,s=this.closed,l=0;for(t=0,o=1;t<(s?e:e-1);t++,o=(t+1)%e){i=n(this.pts,o);l+=Math.hypot(i.x-r.x,i.y-r.y);r=i}return l},loc:function(t){function o(t,o){var n=[];for(var r=t;r<o;r++)n.push("#"+r);return n}for(var n=0;n<t.length;n++){if(t[n]==="beg")t[n]="#0";else if(t[n]==="end")t[n]="#"+Math.max(this.n-1,0);else if(t[n]==="mid")t=t.splice(n,1)&&t.concat(o(1,Math.max(1,this.n-1)));else if(t[n]==="all")t=t.splice(n,1)&&t.concat(o(0,Math.max(1,this.n)));else if(t===undefined)t[n]=.5}return t},p:function(t){if(typeof t==="string"&&t[0]==="#")return this.pIdx(+t.substr(1));else return this.pPar(t)},pIdx:function(t){var o=Math.max(t-1,0),n=Math.min(t+1,this.n-1),r=this.itr,i=r(this.pts,o),e=r(this.pts,t),s=r(this.pts,n),l=s.x-i.x,c=s.y-i.y,a=this.g2.state.cartesian?Math.hypot(l,c):-Math.hypot(l,c);return{x:e.x,y:e.y,dx:l/a,dy:c/a}},pPar:function(t){var o,n,r=this.itr,i=r(this.pts,0),e,s=this.n,l=this.len,c=this.closed,a=0,y,h,u,d,p,f=this.g2.state.cartesian?1:-1;if(l>0){t=Math.max(0,Math.min(1,t));d=t*l;for(o=0,n=1;o<=(c?s:s-1);o++,n=(o+1)%s){e=r(this.pts,n);y=e.x-i.x;h=e.y-i.y;u=Math.hypot(y,h);if(a+u>=d){p=(t-a/l)*l/u;return{x:i.x+p*y,y:i.y+p*h,dx:f*y/u,dy:f*h/u}}a+=u;i=e}}return r(this.pts,0)}};g2.prototype.use.proto={dir:g2.prototype.cir.proto.dir,get x(){return this.a[1].x},get y(){return this.a[1].y},get r(){return 5},p:g2.prototype.cir.proto.p};